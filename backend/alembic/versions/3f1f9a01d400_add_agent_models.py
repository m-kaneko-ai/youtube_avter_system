"""add_agent_models

Revision ID: 3f1f9a01d400
Revises: a1b2c3d4e5f6
Create Date: 2025-12-15 08:39:24.449072

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
import pgvector.sqlalchemy

# revision identifiers, used by Alembic.
revision: str = '3f1f9a01d400'
down_revision: Union[str, None] = 'a1b2c3d4e5f6'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    # Enable pgvector extension
    op.execute('CREATE EXTENSION IF NOT EXISTS vector')

    op.create_table('channel_dna_profiles',
    sa.Column('id', sa.UUID(), nullable=False, comment='プロファイルID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=False, comment='ナレッジID'),
    sa.Column('channel_name', sa.String(length=255), nullable=True, comment='チャンネル名'),
    sa.Column('niche', sa.String(length=100), nullable=True, comment='ニッチ/カテゴリ'),
    sa.Column('signature_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='シグネチャー要素（JSON）'),
    sa.Column('strengths', postgresql.ARRAY(sa.String(length=100)), nullable=True, comment='強み'),
    sa.Column('weaknesses', postgresql.ARRAY(sa.String(length=100)), nullable=True, comment='弱み'),
    sa.Column('content_style', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='コンテンツスタイル（JSON）'),
    sa.Column('visual_identity', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ビジュアルアイデンティティ（JSON）'),
    sa.Column('voice_identity', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ボイスアイデンティティ（JSON）'),
    sa.Column('best_performing_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='最高パフォーマンス要素'),
    sa.Column('underperforming_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='低パフォーマンス要素'),
    sa.Column('improvement_opportunities', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='改善機会'),
    sa.Column('videos_analyzed', sa.Integer(), nullable=True, comment='分析動画数'),
    sa.Column('avg_dna_consistency', sa.Float(), nullable=True, comment='平均DNA一貫性（%）'),
    sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=True, comment='プロファイル埋め込みベクトル'),
    sa.Column('last_updated_at', sa.DateTime(), nullable=True, comment='最終更新日時'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('knowledge_id')
    )
    op.create_table('learning_history',
    sa.Column('id', sa.UUID(), nullable=False, comment='履歴ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('learning_type', sa.String(length=50), nullable=False, comment='学習タイプ'),
    sa.Column('input_data_summary', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='入力データサマリー'),
    sa.Column('output_summary', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='出力サマリー'),
    sa.Column('patterns_discovered', sa.Integer(), nullable=True, comment='発見パターン数'),
    sa.Column('insights_generated', sa.Integer(), nullable=True, comment='生成インサイト数'),
    sa.Column('recommendations_created', sa.Integer(), nullable=True, comment='作成推奨数'),
    sa.Column('processing_time_seconds', sa.Float(), nullable=True, comment='処理時間（秒）'),
    sa.Column('model_version', sa.String(length=50), nullable=True, comment='モデルバージョン'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='実行日時'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('posting_time_analyses',
    sa.Column('id', sa.UUID(), nullable=False, comment='分析ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=False, comment='ナレッジID'),
    sa.Column('video_type', sa.String(length=20), nullable=True, comment='動画タイプ（short/long）'),
    sa.Column('analysis_period_days', sa.Integer(), nullable=True, comment='分析期間（日）'),
    sa.Column('sample_size', sa.Integer(), nullable=True, comment='サンプルサイズ'),
    sa.Column('optimal_day_of_week', sa.Integer(), nullable=True, comment='最適曜日（0=月, 6=日）'),
    sa.Column('optimal_hour', sa.Integer(), nullable=True, comment='最適時間（0-23）'),
    sa.Column('optimal_minute', sa.Integer(), nullable=True, comment='最適分（0-59）'),
    sa.Column('day_performance', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='曜日別パフォーマンス [{day, avg_views, avg_ctr}]'),
    sa.Column('hour_performance', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='時間別パフォーマンス [{hour, avg_views, avg_ctr}]'),
    sa.Column('heatmap_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='曜日×時間ヒートマップ'),
    sa.Column('recommended_slots', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='推奨投稿スロット [{day, hour, score}]'),
    sa.Column('competitor_posting_times', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='競合の投稿時間'),
    sa.Column('avoid_times', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='避けるべき時間'),
    sa.Column('confidence_score', sa.Float(), nullable=True, comment='信頼度スコア（0-1）'),
    sa.Column('analyzed_at', sa.DateTime(), nullable=False, comment='分析日時'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('success_patterns',
    sa.Column('id', sa.UUID(), nullable=False, comment='パターンID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='パターン名'),
    sa.Column('description', sa.Text(), nullable=True, comment='パターン説明'),
    sa.Column('category', sa.Enum('TITLE', 'THUMBNAIL', 'HOOK', 'CONTENT_STRUCTURE', 'CTA', 'TIMING', 'LENGTH', 'TAGS', name='learningcategory'), nullable=False, comment='カテゴリ'),
    sa.Column('pattern_data', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='パターンデータ（JSON）'),
    sa.Column('example_video_ids', postgresql.ARRAY(sa.UUID()), nullable=True, comment='例となる動画ID'),
    sa.Column('avg_performance_boost', sa.Float(), nullable=True, comment='平均パフォーマンス向上率（%）'),
    sa.Column('success_rate', sa.Float(), nullable=True, comment='成功率（%）'),
    sa.Column('application_count', sa.Integer(), nullable=True, comment='適用回数'),
    sa.Column('is_active', sa.Boolean(), nullable=True, comment='有効フラグ'),
    sa.Column('priority', sa.Integer(), nullable=True, comment='優先度'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('utm_default_settings',
    sa.Column('id', sa.UUID(), nullable=False, comment='設定ID（UUID）'),
    sa.Column('default_source', sa.String(length=100), nullable=False, comment='デフォルトソース'),
    sa.Column('default_medium', sa.String(length=100), nullable=False, comment='デフォルトメディウム'),
    sa.Column('campaign_naming_rule', sa.String(length=200), nullable=False, comment='キャンペーン命名規則'),
    sa.Column('created_at', sa.DateTime(), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=False, comment='更新日時'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('cta_templates',
    sa.Column('id', sa.UUID(), nullable=False, comment='CTA ID（UUID）'),
    sa.Column('name', sa.String(length=200), nullable=False, comment='CTA名'),
    sa.Column('type', sa.Enum('LINE', 'EMAIL', 'DOWNLOAD', 'DISCORD', 'WEBINAR', 'LP', 'CUSTOM', name='ctatype'), nullable=False, comment='CTAタイプ'),
    sa.Column('url', sa.Text(), nullable=False, comment='リンクURL'),
    sa.Column('utm_params', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='UTMパラメータ（source, medium, campaign）'),
    sa.Column('short_url', sa.String(length=500), nullable=True, comment='短縮URL'),
    sa.Column('display_text', sa.Text(), nullable=False, comment='表示テキスト'),
    sa.Column('placement', sa.Enum('DESCRIPTION_TOP', 'DESCRIPTION_BOTTOM', 'PINNED_COMMENT', name='ctaplacement'), nullable=False, comment='配置場所'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='有効/無効'),
    sa.Column('conversion_count', sa.Integer(), nullable=False, comment='コンバージョン数（クリック数）'),
    sa.Column('ctr', sa.Float(), nullable=True, comment='CTR（クリック率 %）'),
    sa.Column('created_by', sa.UUID(), nullable=True, comment='作成者ID'),
    sa.Column('created_at', sa.DateTime(), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_cta_templates_is_active'), 'cta_templates', ['is_active'], unique=False)
    op.create_index(op.f('ix_cta_templates_name'), 'cta_templates', ['name'], unique=False)
    op.create_index(op.f('ix_cta_templates_placement'), 'cta_templates', ['placement'], unique=False)
    op.create_index(op.f('ix_cta_templates_type'), 'cta_templates', ['type'], unique=False)
    op.create_table('dna_templates',
    sa.Column('id', sa.UUID(), nullable=False, comment='テンプレートID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='テンプレート名'),
    sa.Column('description', sa.Text(), nullable=True, comment='テンプレート説明'),
    sa.Column('category', sa.String(length=100), nullable=True, comment='カテゴリ'),
    sa.Column('video_type', sa.String(length=20), nullable=True, comment='動画タイプ（short/long）'),
    sa.Column('structure', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='テンプレート構造（JSON）'),
    sa.Column('required_elements', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='必須要素'),
    sa.Column('optional_elements', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='オプション要素'),
    sa.Column('source_dna_ids', postgresql.ARRAY(sa.UUID()), nullable=True, comment='ソースDNA ID'),
    sa.Column('avg_performance_score', sa.Float(), nullable=True, comment='平均パフォーマンススコア'),
    sa.Column('status', sa.Enum('DRAFT', 'ACTIVE', 'ARCHIVED', name='templatestatus'), nullable=True, comment='ステータス'),
    sa.Column('usage_count', sa.Integer(), nullable=True, comment='使用回数'),
    sa.Column('success_rate', sa.Float(), nullable=True, comment='成功率（%）'),
    sa.Column('tags', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='タグ'),
    sa.Column('created_by', sa.UUID(), nullable=True, comment='作成者ID'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('end_screen_templates',
    sa.Column('id', sa.UUID(), nullable=False, comment='テンプレートID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('created_by', sa.UUID(), nullable=True, comment='作成者ID'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='テンプレート名'),
    sa.Column('description', sa.Text(), nullable=True, comment='説明'),
    sa.Column('video_type', sa.String(length=20), nullable=True, comment='動画タイプ（short/long）'),
    sa.Column('layout', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='レイアウト定義'),
    sa.Column('element_configs', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='要素設定'),
    sa.Column('avg_click_through_rate', sa.Float(), nullable=True, comment='平均クリック率'),
    sa.Column('usage_count', sa.Integer(), nullable=True, comment='使用回数'),
    sa.Column('is_default', sa.Boolean(), nullable=True, comment='デフォルト'),
    sa.Column('is_active', sa.Boolean(), nullable=True, comment='有効'),
    sa.Column('tags', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='タグ'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('notifications',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('type', sa.Enum('APPROVAL', 'ALERT', 'INFO', 'COMMENT', 'PERFORMANCE', 'VIDEO', 'TEAM', 'SYSTEM', name='notificationtype'), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('action_url', sa.String(length=500), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=False),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agents',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('knowledge_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('agent_type', sa.Enum('TREND_MONITOR', 'COMPETITOR_ANALYZER', 'COMMENT_RESPONDER', 'CONTENT_SCHEDULER', 'PERFORMANCE_TRACKER', 'QA_CHECKER', 'KEYWORD_RESEARCHER', name='agenttype'), nullable=False),
    sa.Column('status', sa.Enum('IDLE', 'RUNNING', 'PAUSED', 'ERROR', 'DISABLED', name='agentstatus'), nullable=False),
    sa.Column('config', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('credentials', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_enabled', sa.Boolean(), nullable=False),
    sa.Column('auto_execute', sa.Boolean(), nullable=False),
    sa.Column('max_concurrent_tasks', sa.Integer(), nullable=False),
    sa.Column('retry_count', sa.Integer(), nullable=False),
    sa.Column('timeout_seconds', sa.Integer(), nullable=False),
    sa.Column('total_tasks_run', sa.Integer(), nullable=False),
    sa.Column('successful_tasks', sa.Integer(), nullable=False),
    sa.Column('failed_tasks', sa.Integer(), nullable=False),
    sa.Column('last_run_at', sa.DateTime(), nullable=True),
    sa.Column('last_success_at', sa.DateTime(), nullable=True),
    sa.Column('last_error', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['knowledge_id'], ['knowledges.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('comment_templates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('knowledge_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(length=100), nullable=True),
    sa.Column('target_sentiment', sa.Enum('POSITIVE', 'NEUTRAL', 'NEGATIVE', 'QUESTION', name='commentsentiment'), nullable=True),
    sa.Column('target_keywords', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('exclude_keywords', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('min_likes', sa.Integer(), nullable=True),
    sa.Column('template_text', sa.Text(), nullable=False),
    sa.Column('variations', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('use_ai_generation', sa.Boolean(), nullable=False),
    sa.Column('ai_prompt', sa.Text(), nullable=True),
    sa.Column('ai_style', sa.String(length=100), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=False),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('avg_engagement', sa.Float(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['knowledge_id'], ['knowledges.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('learning_insights',
    sa.Column('id', sa.UUID(), nullable=False, comment='インサイトID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID（チャンネル別）'),
    sa.Column('project_id', sa.UUID(), nullable=True, comment='プロジェクトID'),
    sa.Column('insight_type', sa.Enum('SUCCESS_PATTERN', 'FAILURE_PATTERN', 'TREND', 'RECOMMENDATION', 'CORRELATION', name='insighttype'), nullable=False, comment='インサイトタイプ'),
    sa.Column('category', sa.Enum('TITLE', 'THUMBNAIL', 'HOOK', 'CONTENT_STRUCTURE', 'CTA', 'TIMING', 'LENGTH', 'TAGS', name='learningcategory'), nullable=False, comment='学習カテゴリ'),
    sa.Column('title', sa.String(length=255), nullable=False, comment='インサイトタイトル'),
    sa.Column('description', sa.Text(), nullable=True, comment='詳細説明'),
    sa.Column('evidence', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='根拠データ（JSON）'),
    sa.Column('confidence_score', sa.Float(), nullable=True, comment='信頼度スコア（0-1）'),
    sa.Column('sample_size', sa.Integer(), nullable=True, comment='サンプルサイズ'),
    sa.Column('recommendation', sa.Text(), nullable=True, comment='推奨アクション'),
    sa.Column('expected_impact', sa.String(length=100), nullable=True, comment='期待される影響'),
    sa.Column('is_active', sa.Boolean(), nullable=True, comment='有効フラグ'),
    sa.Column('is_applied', sa.Boolean(), nullable=True, comment='適用済みフラグ'),
    sa.Column('applied_at', sa.DateTime(), nullable=True, comment='適用日時'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('series',
    sa.Column('id', sa.UUID(), nullable=False, comment='シリーズID（UUID）'),
    sa.Column('project_id', sa.UUID(), nullable=True, comment='プロジェクトID（外部キー）'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID（外部キー）'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='シリーズ名'),
    sa.Column('description', sa.Text(), nullable=True, comment='シリーズ説明'),
    sa.Column('series_type', sa.Enum('PLAYLIST', 'TOPIC', 'TUTORIAL', 'SEASONAL', 'CAMPAIGN', name='seriestype'), nullable=False, comment='シリーズタイプ'),
    sa.Column('status', sa.Enum('DRAFT', 'ACTIVE', 'PAUSED', 'COMPLETED', 'ARCHIVED', name='seriesstatus'), nullable=False, comment='シリーズステータス'),
    sa.Column('youtube_playlist_id', sa.String(length=100), nullable=True, comment='YouTube再生リストID'),
    sa.Column('youtube_playlist_url', sa.String(length=500), nullable=True, comment='YouTube再生リストURL'),
    sa.Column('thumbnail_url', sa.String(length=500), nullable=True, comment='シリーズサムネイルURL'),
    sa.Column('tags', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='タグ配列'),
    sa.Column('start_date', sa.DateTime(), nullable=True, comment='開始日'),
    sa.Column('end_date', sa.DateTime(), nullable=True, comment='終了日'),
    sa.Column('target_video_count', sa.Integer(), nullable=True, comment='目標動画本数'),
    sa.Column('release_frequency', sa.String(length=50), nullable=True, comment='公開頻度（daily, weekly, biweekly, monthly）'),
    sa.Column('total_videos', sa.Integer(), nullable=False, comment='総動画数'),
    sa.Column('total_views', sa.Integer(), nullable=False, comment='総再生回数'),
    sa.Column('total_watch_time_hours', sa.Float(), nullable=True, comment='総視聴時間（時間）'),
    sa.Column('avg_view_duration_seconds', sa.Integer(), nullable=True, comment='平均視聴時間（秒）'),
    sa.Column('settings', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='追加設定（JSON）'),
    sa.Column('created_by', sa.UUID(), nullable=True, comment='作成者ID'),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_series_knowledge_id'), 'series', ['knowledge_id'], unique=False)
    op.create_index(op.f('ix_series_project_id'), 'series', ['project_id'], unique=False)
    op.create_index(op.f('ix_series_series_type'), 'series', ['series_type'], unique=False)
    op.create_index(op.f('ix_series_status'), 'series', ['status'], unique=False)
    op.create_index(op.f('ix_series_youtube_playlist_id'), 'series', ['youtube_playlist_id'], unique=False)
    op.create_table('ab_tests',
    sa.Column('id', sa.UUID(), nullable=False, comment='テストID'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('created_by', sa.UUID(), nullable=True, comment='作成者ID'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='テスト名'),
    sa.Column('description', sa.Text(), nullable=True, comment='テスト説明'),
    sa.Column('test_type', sa.Enum('THUMBNAIL', 'TITLE', 'DESCRIPTION', name='abtesttype'), nullable=False, comment='テストタイプ'),
    sa.Column('status', sa.Enum('DRAFT', 'RUNNING', 'PAUSED', 'COMPLETED', 'CANCELLED', name='abteststatus'), nullable=True, comment='ステータス'),
    sa.Column('started_at', sa.DateTime(), nullable=True, comment='開始日時'),
    sa.Column('ended_at', sa.DateTime(), nullable=True, comment='終了日時'),
    sa.Column('duration_hours', sa.Integer(), nullable=True, comment='テスト期間（時間）'),
    sa.Column('traffic_split', sa.Float(), nullable=True, comment='トラフィック分割（%）'),
    sa.Column('min_sample_size', sa.Integer(), nullable=True, comment='最小サンプルサイズ'),
    sa.Column('confidence_level', sa.Float(), nullable=True, comment='信頼水準'),
    sa.Column('winner_variant', sa.String(length=10), nullable=True, comment='勝者バリアント（A/B）'),
    sa.Column('statistical_significance', sa.Float(), nullable=True, comment='統計的有意性'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_schedules',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('frequency', sa.Enum('ONCE', 'HOURLY', 'DAILY', 'WEEKLY', 'MONTHLY', 'CUSTOM', name='schedulefrequency'), nullable=False),
    sa.Column('cron_expression', sa.String(length=100), nullable=True),
    sa.Column('hour', sa.Integer(), nullable=True),
    sa.Column('minute', sa.Integer(), nullable=False),
    sa.Column('day_of_week', postgresql.ARRAY(sa.Integer()), nullable=True),
    sa.Column('day_of_month', sa.Integer(), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=False),
    sa.Column('task_config', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('next_run_at', sa.DateTime(), nullable=True),
    sa.Column('last_run_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('comment_queue',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('video_id', sa.UUID(), nullable=False),
    sa.Column('template_id', sa.UUID(), nullable=True),
    sa.Column('youtube_comment_id', sa.String(length=255), nullable=False),
    sa.Column('author_name', sa.String(length=255), nullable=True),
    sa.Column('author_channel_id', sa.String(length=255), nullable=True),
    sa.Column('comment_text', sa.Text(), nullable=False),
    sa.Column('comment_likes', sa.Integer(), nullable=False),
    sa.Column('comment_published_at', sa.DateTime(), nullable=True),
    sa.Column('sentiment', sa.Enum('POSITIVE', 'NEUTRAL', 'NEGATIVE', 'QUESTION', name='commentsentiment'), nullable=True),
    sa.Column('detected_keywords', postgresql.ARRAY(sa.String()), nullable=True),
    sa.Column('sentiment_score', sa.Float(), nullable=True),
    sa.Column('is_question', sa.Boolean(), nullable=False),
    sa.Column('reply_text', sa.Text(), nullable=True),
    sa.Column('reply_generated_by', sa.String(length=50), nullable=True),
    sa.Column('status', sa.Enum('PENDING', 'APPROVED', 'SENT', 'FAILED', 'SKIPPED', name='replystatus'), nullable=False),
    sa.Column('requires_approval', sa.Boolean(), nullable=False),
    sa.Column('approved_by', sa.UUID(), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('youtube_reply_id', sa.String(length=255), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('reply_likes', sa.Integer(), nullable=True),
    sa.Column('engagement_change', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['approved_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['template_id'], ['comment_templates.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('competitor_alerts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=True),
    sa.Column('knowledge_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=500), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('alert_type', sa.String(length=100), nullable=False),
    sa.Column('competitor_channel_id', sa.String(length=255), nullable=True),
    sa.Column('competitor_channel_name', sa.String(length=255), nullable=True),
    sa.Column('competitor_video_id', sa.String(length=255), nullable=True),
    sa.Column('competitor_video_title', sa.String(length=500), nullable=True),
    sa.Column('competitor_video_url', sa.String(length=2048), nullable=True),
    sa.Column('analysis', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('performance_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('suggested_response', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=False),
    sa.Column('is_actioned', sa.Boolean(), nullable=False),
    sa.Column('actioned_at', sa.DateTime(), nullable=True),
    sa.Column('action_taken', sa.Text(), nullable=True),
    sa.Column('detected_at', sa.DateTime(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['knowledge_id'], ['knowledges.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('content_dnas',
    sa.Column('id', sa.UUID(), nullable=False, comment='DNA ID'),
    sa.Column('video_id', sa.UUID(), nullable=True, comment='動画ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID（チャンネル全体のDNA）'),
    sa.Column('name', sa.String(length=255), nullable=True, comment='DNA名'),
    sa.Column('description', sa.Text(), nullable=True, comment='DNA説明'),
    sa.Column('hook_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='フック要素'),
    sa.Column('story_structure', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ストーリー構造'),
    sa.Column('persona_traits', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ペルソナ特性'),
    sa.Column('visual_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ビジュアル要素'),
    sa.Column('audio_elements', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='音声要素'),
    sa.Column('pacing_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='ペースデータ'),
    sa.Column('emotional_arc', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='感情曲線'),
    sa.Column('value_propositions', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='価値提案'),
    sa.Column('cta_patterns', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='CTAパターン'),
    sa.Column('overall_strength', sa.Float(), nullable=True, comment='総合DNA強度（0-100）'),
    sa.Column('uniqueness_score', sa.Float(), nullable=True, comment='ユニークさスコア（0-100）'),
    sa.Column('consistency_score', sa.Float(), nullable=True, comment='一貫性スコア（0-100）'),
    sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=True, comment='DNA埋め込みベクトル'),
    sa.Column('source_videos_count', sa.Integer(), nullable=True, comment='ソース動画数'),
    sa.Column('last_analyzed_at', sa.DateTime(), nullable=True, comment='最終分析日時'),
    sa.Column('analysis_version', sa.String(length=20), nullable=True, comment='分析バージョン'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('cta_click_logs',
    sa.Column('id', sa.UUID(), nullable=False, comment='ログID（UUID）'),
    sa.Column('cta_id', sa.UUID(), nullable=False, comment='CTA ID'),
    sa.Column('video_id', sa.UUID(), nullable=True, comment='動画ID'),
    sa.Column('clicked_at', sa.DateTime(), nullable=False, comment='クリック日時'),
    sa.Column('ip_address', sa.String(length=50), nullable=True, comment='IPアドレス'),
    sa.Column('user_agent', sa.String(length=500), nullable=True, comment='ユーザーエージェント'),
    sa.Column('referrer', sa.Text(), nullable=True, comment='リファラー'),
    sa.Column('utm_params', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='クリック時のUTMパラメータ'),
    sa.ForeignKeyConstraint(['cta_id'], ['cta_templates.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_cta_click_logs_clicked_at'), 'cta_click_logs', ['clicked_at'], unique=False)
    op.create_index(op.f('ix_cta_click_logs_cta_id'), 'cta_click_logs', ['cta_id'], unique=False)
    op.create_index(op.f('ix_cta_click_logs_video_id'), 'cta_click_logs', ['video_id'], unique=False)
    op.create_table('end_screens',
    sa.Column('id', sa.UUID(), nullable=False, comment='終了画面ID'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('start_time_seconds', sa.Float(), nullable=False, comment='開始時間（秒）'),
    sa.Column('duration_seconds', sa.Float(), nullable=True, comment='表示時間（秒）'),
    sa.Column('background_type', sa.String(length=20), nullable=True, comment='背景タイプ（video/image/color）'),
    sa.Column('background_color', sa.String(length=20), nullable=True, comment='背景色'),
    sa.Column('background_image_url', sa.String(length=500), nullable=True, comment='背景画像URL'),
    sa.Column('total_clicks', sa.Integer(), nullable=True, comment='総クリック数'),
    sa.Column('click_through_rate', sa.Float(), nullable=True, comment='クリック率'),
    sa.Column('is_active', sa.Boolean(), nullable=True, comment='有効フラグ'),
    sa.Column('is_published', sa.Boolean(), nullable=True, comment='公開済み'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('performance_records',
    sa.Column('id', sa.UUID(), nullable=False, comment='記録ID'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID'),
    sa.Column('project_id', sa.UUID(), nullable=True, comment='プロジェクトID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('video_type', sa.String(length=20), nullable=False, comment='動画タイプ（short/long）'),
    sa.Column('published_at', sa.DateTime(), nullable=True, comment='公開日時'),
    sa.Column('recorded_at', sa.DateTime(), nullable=False, comment='記録日時'),
    sa.Column('views', sa.Integer(), nullable=True, comment='再生回数'),
    sa.Column('likes', sa.Integer(), nullable=True, comment='いいね数'),
    sa.Column('dislikes', sa.Integer(), nullable=True, comment='低評価数'),
    sa.Column('comments', sa.Integer(), nullable=True, comment='コメント数'),
    sa.Column('shares', sa.Integer(), nullable=True, comment='共有数'),
    sa.Column('subscribers_gained', sa.Integer(), nullable=True, comment='獲得登録者数'),
    sa.Column('subscribers_lost', sa.Integer(), nullable=True, comment='失った登録者数'),
    sa.Column('watch_time_minutes', sa.Float(), nullable=True, comment='総視聴時間（分）'),
    sa.Column('avg_view_duration_seconds', sa.Integer(), nullable=True, comment='平均視聴時間（秒）'),
    sa.Column('avg_view_percentage', sa.Float(), nullable=True, comment='平均視聴率（%）'),
    sa.Column('impressions', sa.Integer(), nullable=True, comment='インプレッション数'),
    sa.Column('ctr', sa.Float(), nullable=True, comment='クリック率（%）'),
    sa.Column('performance_level', sa.Enum('EXCEPTIONAL', 'HIGH', 'AVERAGE', 'BELOW_AVERAGE', 'LOW', name='performancelevel'), nullable=True, comment='パフォーマンスレベル'),
    sa.Column('performance_score', sa.Float(), nullable=True, comment='パフォーマンススコア（0-100）'),
    sa.Column('title_length', sa.Integer(), nullable=True, comment='タイトル文字数'),
    sa.Column('has_number_in_title', sa.Boolean(), nullable=True, comment='タイトルに数字あり'),
    sa.Column('has_question_in_title', sa.Boolean(), nullable=True, comment='タイトルに疑問符あり'),
    sa.Column('has_emoji_in_title', sa.Boolean(), nullable=True, comment='タイトルに絵文字あり'),
    sa.Column('video_length_seconds', sa.Integer(), nullable=True, comment='動画の長さ（秒）'),
    sa.Column('publish_day_of_week', sa.Integer(), nullable=True, comment='公開曜日（0-6）'),
    sa.Column('publish_hour', sa.Integer(), nullable=True, comment='公開時間（0-23）'),
    sa.Column('tags', postgresql.ARRAY(sa.String(length=50)), nullable=True, comment='タグ'),
    sa.Column('category', sa.String(length=100), nullable=True, comment='カテゴリ'),
    sa.Column('extra_attributes', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='追加属性（JSON）'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('posting_schedule_recommendations',
    sa.Column('id', sa.UUID(), nullable=False, comment='推奨ID'),
    sa.Column('analysis_id', sa.UUID(), nullable=False, comment='分析ID'),
    sa.Column('video_id', sa.UUID(), nullable=True, comment='動画ID'),
    sa.Column('recommended_datetime', sa.DateTime(), nullable=False, comment='推奨投稿日時'),
    sa.Column('recommended_day_of_week', sa.Integer(), nullable=False, comment='推奨曜日'),
    sa.Column('recommended_hour', sa.Integer(), nullable=False, comment='推奨時間'),
    sa.Column('score', sa.Float(), nullable=False, comment='推奨スコア（0-100）'),
    sa.Column('reasoning', sa.Text(), nullable=True, comment='推奨理由'),
    sa.Column('predicted_initial_views', sa.Integer(), nullable=True, comment='予測初期再生数'),
    sa.Column('predicted_ctr', sa.Float(), nullable=True, comment='予測CTR'),
    sa.Column('is_accepted', sa.Boolean(), nullable=True, comment='承認済み'),
    sa.Column('actual_posted_at', sa.DateTime(), nullable=True, comment='実際の投稿日時'),
    sa.Column('actual_initial_views', sa.Integer(), nullable=True, comment='実際の初期再生数'),
    sa.Column('actual_ctr', sa.Float(), nullable=True, comment='実際のCTR'),
    sa.Column('accuracy_score', sa.Float(), nullable=True, comment='精度スコア'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.ForeignKeyConstraint(['analysis_id'], ['posting_time_analyses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('recommendations',
    sa.Column('id', sa.UUID(), nullable=False, comment='推奨ID'),
    sa.Column('video_id', sa.UUID(), nullable=True, comment='対象動画ID'),
    sa.Column('project_id', sa.UUID(), nullable=True, comment='プロジェクトID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('category', sa.Enum('TITLE', 'THUMBNAIL', 'HOOK', 'CONTENT_STRUCTURE', 'CTA', 'TIMING', 'LENGTH', 'TAGS', name='learningcategory'), nullable=False, comment='カテゴリ'),
    sa.Column('title', sa.String(length=255), nullable=False, comment='推奨タイトル'),
    sa.Column('description', sa.Text(), nullable=True, comment='推奨説明'),
    sa.Column('action_items', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='アクションアイテム（JSON）'),
    sa.Column('based_on_pattern_id', sa.UUID(), nullable=True, comment='基づくパターンID'),
    sa.Column('based_on_insight_id', sa.UUID(), nullable=True, comment='基づくインサイトID'),
    sa.Column('expected_impact_score', sa.Float(), nullable=True, comment='期待影響スコア（0-100）'),
    sa.Column('expected_metric', sa.String(length=50), nullable=True, comment='期待される指標'),
    sa.Column('expected_improvement', sa.String(length=100), nullable=True, comment='期待される改善'),
    sa.Column('is_applied', sa.Boolean(), nullable=True, comment='適用済みフラグ'),
    sa.Column('applied_at', sa.DateTime(), nullable=True, comment='適用日時'),
    sa.Column('result_score', sa.Float(), nullable=True, comment='結果スコア'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['based_on_insight_id'], ['learning_insights.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['based_on_pattern_id'], ['success_patterns.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('retention_curves',
    sa.Column('id', sa.UUID(), nullable=False, comment='曲線ID'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID'),
    sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID'),
    sa.Column('data_points', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='リテンションデータポイント [{timestamp, retention_rate}]'),
    sa.Column('avg_view_percentage', sa.Float(), nullable=True, comment='平均視聴率（%）'),
    sa.Column('avg_view_duration_seconds', sa.Integer(), nullable=True, comment='平均視聴時間（秒）'),
    sa.Column('hook_retention', sa.Float(), nullable=True, comment='フック（最初30秒）リテンション率'),
    sa.Column('mid_retention', sa.Float(), nullable=True, comment='中盤リテンション率'),
    sa.Column('end_retention', sa.Float(), nullable=True, comment='終盤リテンション率'),
    sa.Column('major_drop_points', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='主要離脱ポイント [{timestamp, drop_rate}]'),
    sa.Column('recovery_points', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='回復ポイント [{timestamp, recovery_rate}]'),
    sa.Column('benchmark_comparison', sa.Float(), nullable=True, comment='ベンチマーク比較（%差）'),
    sa.Column('category_rank', sa.Integer(), nullable=True, comment='カテゴリ内順位'),
    sa.Column('video_length_seconds', sa.Integer(), nullable=True, comment='動画の長さ（秒）'),
    sa.Column('sample_size', sa.Integer(), nullable=True, comment='サンプルサイズ（視聴回数）'),
    sa.Column('recorded_at', sa.DateTime(), nullable=False, comment='記録日時'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('series_performance_logs',
    sa.Column('id', sa.UUID(), nullable=False, comment='ログID（UUID）'),
    sa.Column('series_id', sa.UUID(), nullable=False, comment='シリーズID（外部キー）'),
    sa.Column('recorded_date', sa.DateTime(), nullable=False, comment='記録日'),
    sa.Column('total_views', sa.Integer(), nullable=False, comment='日次総再生回数'),
    sa.Column('new_subscribers', sa.Integer(), nullable=False, comment='新規登録者数'),
    sa.Column('watch_time_minutes', sa.Float(), nullable=True, comment='視聴時間（分）'),
    sa.Column('impressions', sa.Integer(), nullable=True, comment='インプレッション数'),
    sa.Column('impression_ctr', sa.Float(), nullable=True, comment='インプレッションCTR（%）'),
    sa.Column('extra_metrics', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='追加指標（JSON）'),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='作成日時'),
    sa.ForeignKeyConstraint(['series_id'], ['series.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_series_performance_logs_recorded_date'), 'series_performance_logs', ['recorded_date'], unique=False)
    op.create_index(op.f('ix_series_performance_logs_series_id'), 'series_performance_logs', ['series_id'], unique=False)
    op.create_table('series_video_items',
    sa.Column('id', sa.UUID(), nullable=False, comment='アイテムID（UUID）'),
    sa.Column('series_id', sa.UUID(), nullable=False, comment='シリーズID（外部キー）'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID（外部キー）'),
    sa.Column('order_index', sa.Integer(), nullable=False, comment='並び順インデックス'),
    sa.Column('episode_number', sa.Integer(), nullable=True, comment='エピソード番号'),
    sa.Column('episode_title', sa.String(length=255), nullable=True, comment='エピソードタイトル（シリーズ内用）'),
    sa.Column('is_published', sa.Boolean(), nullable=False, comment='公開済みフラグ'),
    sa.Column('published_at', sa.DateTime(), nullable=True, comment='公開日時'),
    sa.Column('scheduled_at', sa.DateTime(), nullable=True, comment='公開予定日時'),
    sa.Column('views', sa.Integer(), nullable=False, comment='再生回数'),
    sa.Column('likes', sa.Integer(), nullable=False, comment='いいね数'),
    sa.Column('comments', sa.Integer(), nullable=False, comment='コメント数'),
    sa.Column('avg_view_duration_seconds', sa.Integer(), nullable=True, comment='平均視聴時間（秒）'),
    sa.Column('retention_rate', sa.Float(), nullable=True, comment='リテンション率（%）'),
    sa.Column('added_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='追加日時'),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['series_id'], ['series.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_series_video_items_series_id'), 'series_video_items', ['series_id'], unique=False)
    op.create_index(op.f('ix_series_video_items_video_id'), 'series_video_items', ['video_id'], unique=False)
    op.create_table('short_to_long_links',
    sa.Column('id', sa.UUID(), nullable=False, comment='連携ID（UUID）'),
    sa.Column('short_video_id', sa.UUID(), nullable=False, comment='ショート動画ID（外部キー）'),
    sa.Column('long_video_id', sa.UUID(), nullable=False, comment='長尺動画ID（外部キー）'),
    sa.Column('link_type', sa.String(length=50), nullable=False, comment='連携タイプ（description, pinned_comment, end_screen, card）'),
    sa.Column('link_text', sa.Text(), nullable=True, comment='誘導テキスト'),
    sa.Column('link_position', sa.String(length=50), nullable=True, comment='リンク配置位置（top, bottom, time_XX:XX）'),
    sa.Column('status', sa.Enum('DRAFT', 'ACTIVE', 'PAUSED', 'COMPLETED', 'ARCHIVED', name='engagementstatus'), nullable=False, comment='連携ステータス'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='有効/無効'),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['long_video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['short_video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_short_to_long_links_long_video_id'), 'short_to_long_links', ['long_video_id'], unique=False)
    op.create_index(op.f('ix_short_to_long_links_short_video_id'), 'short_to_long_links', ['short_video_id'], unique=False)
    op.create_index(op.f('ix_short_to_long_links_status'), 'short_to_long_links', ['status'], unique=False)
    op.create_table('short_video_clips',
    sa.Column('id', sa.UUID(), nullable=False, comment='切り抜きID（UUID）'),
    sa.Column('short_video_id', sa.UUID(), nullable=False, comment='ショート動画ID（外部キー）'),
    sa.Column('source_video_id', sa.UUID(), nullable=True, comment='元動画ID（外部キー）'),
    sa.Column('start_time_seconds', sa.Integer(), nullable=True, comment='元動画の開始時間（秒）'),
    sa.Column('end_time_seconds', sa.Integer(), nullable=True, comment='元動画の終了時間（秒）'),
    sa.Column('clip_title', sa.String(length=200), nullable=True, comment='切り抜きタイトル'),
    sa.Column('clip_description', sa.Text(), nullable=True, comment='切り抜き説明'),
    sa.Column('is_published', sa.Boolean(), nullable=False, comment='公開済みフラグ'),
    sa.Column('published_at', sa.DateTime(), nullable=True, comment='公開日時'),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['short_video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['source_video_id'], ['videos.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_short_video_clips_short_video_id'), 'short_video_clips', ['short_video_id'], unique=False)
    op.create_index(op.f('ix_short_video_clips_source_video_id'), 'short_video_clips', ['source_video_id'], unique=False)
    op.create_table('tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('video_id', sa.UUID(), nullable=True),
    sa.Column('project_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.Enum('SCRIPT', 'THUMBNAIL', 'VIDEO', 'PUBLISH', 'REVIEW', name='taskcategory'), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'OVERDUE', name='taskstatus'), nullable=False),
    sa.Column('priority', sa.Enum('HIGH', 'MEDIUM', 'LOW', name='taskpriority'), nullable=False),
    sa.Column('due_date', sa.DateTime(), nullable=True),
    sa.Column('due_time', sa.String(length=10), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('trend_alerts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=True),
    sa.Column('knowledge_id', sa.UUID(), nullable=True),
    sa.Column('title', sa.String(length=500), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('alert_type', sa.String(length=100), nullable=False),
    sa.Column('source', sa.String(length=100), nullable=True),
    sa.Column('source_url', sa.String(length=2048), nullable=True),
    sa.Column('keyword', sa.String(length=255), nullable=True),
    sa.Column('trend_score', sa.Float(), nullable=True),
    sa.Column('growth_rate', sa.Float(), nullable=True),
    sa.Column('related_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('suggested_actions', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=False),
    sa.Column('is_actioned', sa.Boolean(), nullable=False),
    sa.Column('actioned_at', sa.DateTime(), nullable=True),
    sa.Column('action_taken', sa.Text(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('detected_at', sa.DateTime(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['knowledge_id'], ['knowledges.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('video_cta_assignments',
    sa.Column('id', sa.UUID(), nullable=False, comment='割り当てID（UUID）'),
    sa.Column('video_id', sa.UUID(), nullable=False, comment='動画ID'),
    sa.Column('cta_id', sa.UUID(), nullable=False, comment='CTA ID'),
    sa.Column('placement', sa.Enum('DESCRIPTION_TOP', 'DESCRIPTION_BOTTOM', 'PINNED_COMMENT', name='ctaplacement'), nullable=False, comment='配置場所'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='有効/無効'),
    sa.Column('created_at', sa.DateTime(), nullable=False, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=False, comment='更新日時'),
    sa.ForeignKeyConstraint(['cta_id'], ['cta_templates.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_video_cta_assignments_cta_id'), 'video_cta_assignments', ['cta_id'], unique=False)
    op.create_index(op.f('ix_video_cta_assignments_placement'), 'video_cta_assignments', ['placement'], unique=False)
    op.create_index(op.f('ix_video_cta_assignments_video_id'), 'video_cta_assignments', ['video_id'], unique=False)
    op.create_table('ab_test_variants',
    sa.Column('id', sa.UUID(), nullable=False, comment='バリアントID'),
    sa.Column('ab_test_id', sa.UUID(), nullable=False, comment='テストID'),
    sa.Column('variant_name', sa.String(length=10), nullable=False, comment='バリアント名（A/B）'),
    sa.Column('is_control', sa.Boolean(), nullable=True, comment='コントロール（元のバージョン）'),
    sa.Column('content', sa.Text(), nullable=True, comment='コンテンツ（タイトル/説明）'),
    sa.Column('image_url', sa.String(length=500), nullable=True, comment='画像URL（サムネイル）'),
    sa.Column('image_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='画像メタデータ'),
    sa.Column('impressions', sa.Integer(), nullable=True, comment='インプレッション数'),
    sa.Column('clicks', sa.Integer(), nullable=True, comment='クリック数'),
    sa.Column('views', sa.Integer(), nullable=True, comment='再生回数'),
    sa.Column('ctr', sa.Float(), nullable=True, comment='クリック率（%）'),
    sa.Column('avg_view_duration', sa.Float(), nullable=True, comment='平均視聴時間（秒）'),
    sa.Column('avg_view_percentage', sa.Float(), nullable=True, comment='平均視聴率（%）'),
    sa.Column('likes', sa.Integer(), nullable=True, comment='いいね数'),
    sa.Column('comments', sa.Integer(), nullable=True, comment='コメント数'),
    sa.Column('shares', sa.Integer(), nullable=True, comment='共有数'),
    sa.Column('subscribers_gained', sa.Integer(), nullable=True, comment='獲得登録者数'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['ab_test_id'], ['ab_tests.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_tasks',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=False),
    sa.Column('schedule_id', sa.UUID(), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('task_type', sa.String(length=100), nullable=True),
    sa.Column('priority', sa.Enum('LOW', 'NORMAL', 'HIGH', 'URGENT', name='taskpriority'), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'RUNNING', 'COMPLETED', 'FAILED', 'CANCELLED', name='taskstatus'), nullable=False),
    sa.Column('input_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('output_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('duration_seconds', sa.Float(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('error_details', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=False),
    sa.Column('max_retries', sa.Integer(), nullable=False),
    sa.Column('progress_percent', sa.Float(), nullable=True),
    sa.Column('progress_message', sa.String(length=500), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['schedule_id'], ['agent_schedules.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('dna_comparisons',
    sa.Column('id', sa.UUID(), nullable=False, comment='比較ID'),
    sa.Column('source_dna_id', sa.UUID(), nullable=False, comment='ソースDNA ID'),
    sa.Column('target_dna_id', sa.UUID(), nullable=False, comment='ターゲットDNA ID'),
    sa.Column('overall_similarity', sa.Float(), nullable=False, comment='総合類似度（0-1）'),
    sa.Column('hook_similarity', sa.Float(), nullable=True, comment='フック類似度'),
    sa.Column('structure_similarity', sa.Float(), nullable=True, comment='構造類似度'),
    sa.Column('style_similarity', sa.Float(), nullable=True, comment='スタイル類似度'),
    sa.Column('comparison_details', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='比較詳細（JSON）'),
    sa.Column('shared_elements', postgresql.ARRAY(sa.String(length=100)), nullable=True, comment='共通要素'),
    sa.Column('unique_to_source', postgresql.ARRAY(sa.String(length=100)), nullable=True, comment='ソース固有要素'),
    sa.Column('unique_to_target', postgresql.ARRAY(sa.String(length=100)), nullable=True, comment='ターゲット固有要素'),
    sa.Column('recommendations', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='推奨事項（JSON）'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.ForeignKeyConstraint(['source_dna_id'], ['content_dnas.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['target_dna_id'], ['content_dnas.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('dna_elements',
    sa.Column('id', sa.UUID(), nullable=False, comment='要素ID'),
    sa.Column('content_dna_id', sa.UUID(), nullable=False, comment='DNA ID'),
    sa.Column('element_type', sa.Enum('HOOK', 'STORY_ARC', 'PERSONA', 'VISUAL_STYLE', 'AUDIO_STYLE', 'PACING', 'EMOTION', 'VALUE_PROP', 'CTA_STYLE', 'FORMAT', name='dnaelementtype'), nullable=False, comment='要素タイプ'),
    sa.Column('name', sa.String(length=255), nullable=False, comment='要素名'),
    sa.Column('description', sa.Text(), nullable=True, comment='要素説明'),
    sa.Column('data', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='要素データ（JSON）'),
    sa.Column('examples', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='例（JSON）'),
    sa.Column('timestamps', postgresql.ARRAY(sa.Float()), nullable=True, comment='タイムスタンプ（秒）'),
    sa.Column('strength', sa.Enum('SIGNATURE', 'STRONG', 'MODERATE', 'WEAK', 'ABSENT', name='dnastrength'), nullable=True, comment='強度'),
    sa.Column('strength_score', sa.Float(), nullable=True, comment='強度スコア（0-100）'),
    sa.Column('impact_on_retention', sa.Float(), nullable=True, comment='視聴維持への影響（%）'),
    sa.Column('impact_on_engagement', sa.Float(), nullable=True, comment='エンゲージメントへの影響（%）'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['content_dna_id'], ['content_dnas.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('end_screen_elements',
    sa.Column('id', sa.UUID(), nullable=False, comment='要素ID'),
    sa.Column('end_screen_id', sa.UUID(), nullable=False, comment='終了画面ID'),
    sa.Column('element_type', sa.Enum('VIDEO', 'PLAYLIST', 'SUBSCRIBE', 'LINK', name='endscreenelementtype'), nullable=False, comment='要素タイプ'),
    sa.Column('position', sa.Enum('TOP_LEFT', 'TOP_RIGHT', 'BOTTOM_LEFT', 'BOTTOM_RIGHT', 'CENTER', name='endscreenposition'), nullable=False, comment='位置'),
    sa.Column('position_x', sa.Float(), nullable=True, comment='X座標（%）'),
    sa.Column('position_y', sa.Float(), nullable=True, comment='Y座標（%）'),
    sa.Column('width', sa.Float(), nullable=True, comment='幅（%）'),
    sa.Column('height', sa.Float(), nullable=True, comment='高さ（%）'),
    sa.Column('start_offset_seconds', sa.Float(), nullable=True, comment='開始オフセット（秒）'),
    sa.Column('duration_seconds', sa.Float(), nullable=True, comment='表示時間（秒）'),
    sa.Column('target_video_id', sa.UUID(), nullable=True, comment='対象動画ID'),
    sa.Column('target_playlist_id', sa.String(length=100), nullable=True, comment='対象プレイリストID'),
    sa.Column('target_url', sa.String(length=500), nullable=True, comment='対象URL'),
    sa.Column('custom_message', sa.String(length=200), nullable=True, comment='カスタムメッセージ'),
    sa.Column('display_text', sa.String(length=100), nullable=True, comment='表示テキスト'),
    sa.Column('thumbnail_url', sa.String(length=500), nullable=True, comment='サムネイルURL'),
    sa.Column('impressions', sa.Integer(), nullable=True, comment='インプレッション数'),
    sa.Column('clicks', sa.Integer(), nullable=True, comment='クリック数'),
    sa.Column('click_through_rate', sa.Float(), nullable=True, comment='クリック率'),
    sa.Column('display_order', sa.Integer(), nullable=True, comment='表示順序'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.Column('updated_at', sa.DateTime(), nullable=True, comment='更新日時'),
    sa.ForeignKeyConstraint(['end_screen_id'], ['end_screens.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('engagement_metrics',
    sa.Column('id', sa.UUID(), nullable=False, comment='指標ID（UUID）'),
    sa.Column('link_id', sa.UUID(), nullable=False, comment='連携ID（外部キー）'),
    sa.Column('recorded_date', sa.DateTime(), nullable=False, comment='記録日'),
    sa.Column('short_views', sa.Integer(), nullable=False, comment='ショート動画再生回数'),
    sa.Column('short_likes', sa.Integer(), nullable=False, comment='ショート動画いいね数'),
    sa.Column('short_comments', sa.Integer(), nullable=False, comment='ショート動画コメント数'),
    sa.Column('short_shares', sa.Integer(), nullable=False, comment='ショート動画共有数'),
    sa.Column('long_views', sa.Integer(), nullable=False, comment='長尺動画再生回数'),
    sa.Column('long_likes', sa.Integer(), nullable=False, comment='長尺動画いいね数'),
    sa.Column('long_comments', sa.Integer(), nullable=False, comment='長尺動画コメント数'),
    sa.Column('long_watch_time_minutes', sa.Float(), nullable=True, comment='長尺動画総視聴時間（分）'),
    sa.Column('click_through_count', sa.Integer(), nullable=False, comment='クリックスルー数（ショート→長尺）'),
    sa.Column('click_through_rate', sa.Float(), nullable=True, comment='クリックスルー率（%）'),
    sa.Column('conversion_count', sa.Integer(), nullable=False, comment='コンバージョン数（長尺で一定時間以上視聴）'),
    sa.Column('conversion_rate', sa.Float(), nullable=True, comment='コンバージョン率（%）'),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='追加指標データ（JSON）'),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('NOW()'), nullable=False, comment='作成日時'),
    sa.ForeignKeyConstraint(['link_id'], ['short_to_long_links.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_engagement_metrics_link_id'), 'engagement_metrics', ['link_id'], unique=False)
    op.create_index(op.f('ix_engagement_metrics_recorded_date'), 'engagement_metrics', ['recorded_date'], unique=False)
    op.create_table('retention_events',
    sa.Column('id', sa.UUID(), nullable=False, comment='イベントID'),
    sa.Column('retention_curve_id', sa.UUID(), nullable=False, comment='曲線ID'),
    sa.Column('event_type', sa.Enum('HOOK', 'DROP', 'SPIKE', 'CTA', 'END', name='retentioneventtype'), nullable=False, comment='イベントタイプ'),
    sa.Column('timestamp_seconds', sa.Float(), nullable=False, comment='タイムスタンプ（秒）'),
    sa.Column('timestamp_percentage', sa.Float(), nullable=True, comment='タイムスタンプ（%）'),
    sa.Column('retention_before', sa.Float(), nullable=True, comment='イベント前リテンション率'),
    sa.Column('retention_after', sa.Float(), nullable=True, comment='イベント後リテンション率'),
    sa.Column('change_rate', sa.Float(), nullable=True, comment='変化率（%）'),
    sa.Column('content_at_timestamp', sa.Text(), nullable=True, comment='タイムスタンプ時のコンテンツ'),
    sa.Column('analysis_notes', sa.Text(), nullable=True, comment='分析ノート'),
    sa.Column('recommended_action', sa.Text(), nullable=True, comment='推奨アクション'),
    sa.Column('created_at', sa.DateTime(), nullable=True, comment='作成日時'),
    sa.ForeignKeyConstraint(['retention_curve_id'], ['retention_curves.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_logs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('agent_id', sa.UUID(), nullable=False),
    sa.Column('task_id', sa.UUID(), nullable=True),
    sa.Column('level', sa.String(length=20), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('details', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('source', sa.String(length=255), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['agent_id'], ['agents.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['task_id'], ['agent_tasks.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.add_column('ai_suggestions', sa.Column('title', sa.String(length=500), nullable=False, comment='提案タイトル'))
    op.add_column('ai_suggestions', sa.Column('description', sa.Text(), nullable=True, comment='提案説明'))
    op.add_column('ai_suggestions', sa.Column('tags', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='タグ（JSON配列）'))
    op.add_column('ai_suggestions', sa.Column('estimated_views', sa.String(length=50), nullable=True, comment='予想視聴数（例：50K-100K）'))
    op.add_column('ai_suggestions', sa.Column('confidence', sa.Float(), nullable=True, comment='信頼度（0.0-1.0）'))
    op.add_column('ai_suggestions', sa.Column('adopted_project_id', sa.UUID(), nullable=True, comment='採用されたプロジェクトID（外部キー）'))
    op.alter_column('ai_suggestions', 'id',
               existing_type=sa.UUID(),
               comment='提案ID（UUID）',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'session_id',
               existing_type=sa.UUID(),
               comment='セッションID（外部キー）',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'suggestion_type',
               existing_type=postgresql.ENUM('TITLE', 'TOPIC', 'OUTLINE', 'HOOK', 'CTA', 'TARGET_AUDIENCE', name='suggestiontype'),
               comment='提案種別（short/long）',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'is_adopted',
               existing_type=sa.BOOLEAN(),
               comment='採用フラグ',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'adopted_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='採用日時',
               existing_nullable=True)
    op.alter_column('ai_suggestions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.drop_index(op.f('ix_ai_suggestions_suggestion_type'), table_name='ai_suggestions')
    op.create_index(op.f('ix_ai_suggestions_adopted_project_id'), 'ai_suggestions', ['adopted_project_id'], unique=False)
    op.create_foreign_key(None, 'ai_suggestions', 'projects', ['adopted_project_id'], ['id'], ondelete='SET NULL')
    op.drop_column('ai_suggestions', 'metadata')
    op.drop_column('ai_suggestions', 'content')
    op.drop_column('ai_suggestions', 'confidence_score')
    op.drop_column('ai_suggestions', 'feedback')
    op.alter_column('analytics_reports', 'id',
               existing_type=sa.UUID(),
               comment='レポートID（UUID）',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'client_id',
               existing_type=sa.UUID(),
               comment='クライアントID（外部キー）',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'report_type',
               existing_type=postgresql.ENUM('DAILY', 'WEEKLY', 'MONTHLY', 'CUSTOM', name='reporttype'),
               comment='レポートタイプ',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='reportstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'title',
               existing_type=sa.VARCHAR(length=500),
               comment='レポートタイトル',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'date_from',
               existing_type=sa.DATE(),
               comment='開始日',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'date_to',
               existing_type=sa.DATE(),
               comment='終了日',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'summary',
               existing_type=sa.TEXT(),
               comment='レポートサマリー',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='レポートデータ（JSON）',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'file_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='レポートファイルURL',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.create_index(op.f('ix_analytics_reports_status'), 'analytics_reports', ['status'], unique=False)
    op.alter_column('api_connections', 'id',
               existing_type=sa.UUID(),
               comment='連携ID（UUID）',
               existing_nullable=False)
    op.alter_column('api_connections', 'name',
               existing_type=sa.VARCHAR(length=100),
               comment='連携名',
               existing_nullable=False)
    op.alter_column('api_connections', 'service',
               existing_type=sa.VARCHAR(length=50),
               comment='サービス名（youtube/tiktok/heygen等）',
               existing_nullable=False)
    op.alter_column('api_connections', 'client_id',
               existing_type=sa.UUID(),
               comment='クライアントID（クライアント固有の場合）',
               existing_nullable=True)
    op.alter_column('api_connections', 'status',
               existing_type=postgresql.ENUM('ACTIVE', 'INACTIVE', 'ERROR', name='apiconnectionstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('api_connections', 'credentials',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='認証情報（暗号化済み）',
               existing_nullable=True)
    op.alter_column('api_connections', 'settings',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='連携設定',
               existing_nullable=True)
    op.alter_column('api_connections', 'last_sync_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='最終同期日時',
               existing_nullable=True)
    op.alter_column('api_connections', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('api_connections', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('api_connections', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.alter_column('audio_generations', 'id',
               existing_type=sa.UUID(),
               comment='音声生成ID（UUID）',
               existing_nullable=False)
    op.alter_column('audio_generations', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('audio_generations', 'script_id',
               existing_type=sa.UUID(),
               comment='台本ID（外部キー）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'voice_id',
               existing_type=sa.VARCHAR(length=100),
               comment='MiniMax Audio ボイスID',
               existing_nullable=True)
    op.alter_column('audio_generations', 'voice_name',
               existing_type=sa.VARCHAR(length=200),
               comment='ボイス名',
               existing_nullable=True)
    op.alter_column('audio_generations', 'text',
               existing_type=sa.TEXT(),
               comment='読み上げテキスト',
               existing_nullable=True)
    op.alter_column('audio_generations', 'audio_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='生成された音声URL',
               existing_nullable=True)
    op.alter_column('audio_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='音声長（秒）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('audio_generations', 'speed',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='読み上げ速度',
               existing_nullable=True)
    op.alter_column('audio_generations', 'pitch',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='ピッチ調整',
               existing_nullable=True)
    op.alter_column('audio_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('audio_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('audio_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.create_index(op.f('ix_audio_generations_script_id'), 'audio_generations', ['script_id'], unique=False)
    op.alter_column('audit_logs', 'id',
               existing_type=sa.UUID(),
               comment='ログID（UUID）',
               existing_nullable=False)
    op.alter_column('audit_logs', 'user_id',
               existing_type=sa.UUID(),
               comment='ユーザーID',
               existing_nullable=True)
    op.alter_column('audit_logs', 'action',
               existing_type=postgresql.ENUM('CREATE', 'READ', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT', 'EXPORT', 'GENERATE', name='auditaction'),
               comment='アクション',
               existing_nullable=False)
    op.alter_column('audit_logs', 'resource_type',
               existing_type=sa.VARCHAR(length=50),
               comment='リソース種別',
               existing_nullable=False)
    op.alter_column('audit_logs', 'resource_id',
               existing_type=sa.VARCHAR(length=100),
               comment='リソースID',
               existing_nullable=True)
    op.alter_column('audit_logs', 'description',
               existing_type=sa.TEXT(),
               comment='説明',
               existing_nullable=True)
    op.alter_column('audit_logs', 'ip_address',
               existing_type=sa.VARCHAR(length=50),
               comment='IPアドレス',
               existing_nullable=True)
    op.alter_column('audit_logs', 'user_agent',
               existing_type=sa.VARCHAR(length=500),
               comment='ユーザーエージェント',
               existing_nullable=True)
    op.alter_column('audit_logs', 'extra_data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='追加メタデータ',
               existing_nullable=True)
    op.alter_column('audit_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'id',
               existing_type=sa.UUID(),
               comment='アバター生成ID（UUID）',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'audio_id',
               existing_type=sa.UUID(),
               comment='音声ID（外部キー）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'avatar_id',
               existing_type=sa.VARCHAR(length=100),
               comment='HeyGen アバターID',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'avatar_name',
               existing_type=sa.VARCHAR(length=200),
               comment='アバター名',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'video_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='生成された動画URL',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'thumbnail_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='動画サムネイルURL',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='動画長（秒）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'width',
               existing_type=sa.INTEGER(),
               comment='動画幅（px）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'height',
               existing_type=sa.INTEGER(),
               comment='動画高さ（px）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'heygen_task_id',
               existing_type=sa.VARCHAR(length=200),
               type_=sa.String(length=100),
               comment='HeyGen タスクID',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.create_index(op.f('ix_avatar_generations_audio_id'), 'avatar_generations', ['audio_id'], unique=False)
    op.alter_column('broll_generations', 'id',
               existing_type=sa.UUID(),
               comment='B-roll生成ID（UUID）',
               existing_nullable=False)
    op.alter_column('broll_generations', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('broll_generations', 'prompt',
               existing_type=sa.TEXT(),
               comment='生成プロンプト',
               existing_nullable=True)
    op.alter_column('broll_generations', 'style',
               existing_type=sa.VARCHAR(length=100),
               type_=sa.String(length=50),
               comment='映像スタイル',
               existing_nullable=True)
    op.alter_column('broll_generations', 'video_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='生成された動画URL',
               existing_nullable=True)
    op.alter_column('broll_generations', 'thumbnail_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='動画サムネイルURL',
               existing_nullable=True)
    op.alter_column('broll_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='動画長（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'width',
               existing_type=sa.INTEGER(),
               comment='動画幅（px）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'height',
               existing_type=sa.INTEGER(),
               comment='動画高さ（px）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('broll_generations', 'veo_task_id',
               existing_type=sa.VARCHAR(length=200),
               type_=sa.String(length=100),
               comment='Veo タスクID',
               existing_nullable=True)
    op.alter_column('broll_generations', 'timestamp_start',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='挿入開始位置（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'timestamp_end',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='挿入終了位置（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('broll_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('broll_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'id',
               existing_type=sa.UUID(),
               comment='分析ID（UUID）',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'client_id',
               existing_type=sa.UUID(),
               comment='クライアントID（外部キー）',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'date',
               existing_type=sa.DATE(),
               comment='分析日',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'total_views',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='総視聴回数')
    op.alter_column('channel_analytics', 'total_watch_time_minutes',
               existing_type=sa.INTEGER(),
               type_=sa.Float(),
               nullable=True,
               comment='総視聴時間（分）')
    op.alter_column('channel_analytics', 'subscribers',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='総登録者数')
    op.alter_column('channel_analytics', 'subscribers_change',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='登録者数変化')
    op.alter_column('channel_analytics', 'total_videos',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='総動画数')
    op.alter_column('channel_analytics', 'average_ctr',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='平均クリック率（%）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'revenue',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='収益（円）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'top_videos',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='トップ動画（JSON）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.drop_column('channel_analytics', 'updated_at')
    op.add_column('metadata_generations', sa.Column('metadata_type', sa.String(length=50), nullable=False, comment='メタデータ種別（title/description）'))
    op.add_column('metadata_generations', sa.Column('prompt', sa.Text(), nullable=True, comment='生成に使用したプロンプト'))
    op.add_column('metadata_generations', sa.Column('result', sa.Text(), nullable=True, comment='生成結果'))
    op.add_column('metadata_generations', sa.Column('alternatives', postgresql.JSONB(astext_type=sa.Text()), nullable=True, comment='代替案（JSON配列）'))
    op.alter_column('metadata_generations', 'id',
               existing_type=sa.UUID(),
               comment='生成履歴ID（UUID）',
               existing_nullable=False)
    op.alter_column('metadata_generations', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('metadata_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.create_index(op.f('ix_metadata_generations_metadata_type'), 'metadata_generations', ['metadata_type'], unique=False)
    op.drop_column('metadata_generations', 'generation_params')
    op.drop_column('metadata_generations', 'version')
    op.drop_column('metadata_generations', 'description')
    op.drop_column('metadata_generations', 'title')
    op.drop_column('metadata_generations', 'tags')
    op.drop_column('metadata_generations', 'category')
    op.drop_column('metadata_generations', 'updated_at')
    op.add_column('planning_chat_sessions', sa.Column('client_id', sa.UUID(), nullable=False, comment='クライアントID（外部キー）'))
    op.add_column('planning_chat_sessions', sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID（外部キー）'))
    op.alter_column('planning_chat_sessions', 'id',
               existing_type=sa.UUID(),
               comment='セッションID（UUID）',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'status',
               existing_type=postgresql.ENUM('ACTIVE', 'COMPLETED', 'ABANDONED', name='planningsessionstatus'),
               comment='セッションステータス',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'messages',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               nullable=False,
               comment="メッセージ履歴（[{type: 'user'|'assistant', content: str, suggestions: [], created_at: str}]）")
    op.alter_column('planning_chat_sessions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.drop_index(op.f('ix_planning_chat_sessions_project_id'), table_name='planning_chat_sessions')
    op.drop_index(op.f('ix_planning_chat_sessions_user_id'), table_name='planning_chat_sessions')
    op.create_index(op.f('ix_planning_chat_sessions_client_id'), 'planning_chat_sessions', ['client_id'], unique=False)
    op.create_index(op.f('ix_planning_chat_sessions_knowledge_id'), 'planning_chat_sessions', ['knowledge_id'], unique=False)
    op.drop_constraint(op.f('planning_chat_sessions_user_id_fkey'), 'planning_chat_sessions', type_='foreignkey')
    op.drop_constraint(op.f('planning_chat_sessions_project_id_fkey'), 'planning_chat_sessions', type_='foreignkey')
    op.create_foreign_key(None, 'planning_chat_sessions', 'knowledges', ['knowledge_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(None, 'planning_chat_sessions', 'clients', ['client_id'], ['id'], ondelete='CASCADE')
    op.drop_column('planning_chat_sessions', 'user_id')
    op.drop_column('planning_chat_sessions', 'context')
    op.drop_column('planning_chat_sessions', 'project_id')
    op.add_column('project_schedules', sa.Column('published_date', sa.Date(), nullable=True, comment='公開日'))
    op.alter_column('project_schedules', 'id',
               existing_type=sa.UUID(),
               comment='スケジュールID（UUID）',
               existing_nullable=False)
    op.alter_column('project_schedules', 'project_id',
               existing_type=sa.UUID(),
               comment='プロジェクトID（外部キー）',
               existing_nullable=False)
    op.alter_column('project_schedules', 'scheduled_date',
               existing_type=sa.DATE(),
               comment='予定日',
               existing_nullable=False)
    op.alter_column('project_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('project_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.drop_index(op.f('ix_project_schedules_project_id'), table_name='project_schedules')
    op.create_index(op.f('ix_project_schedules_project_id'), 'project_schedules', ['project_id'], unique=True)
    op.drop_column('project_schedules', 'notes')
    op.drop_column('project_schedules', 'priority')
    op.drop_column('project_schedules', 'publish_time')
    op.alter_column('publications', 'id',
               existing_type=sa.UUID(),
               comment='公開ID（UUID）',
               existing_nullable=False)
    op.alter_column('publications', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('publications', 'platform',
               existing_type=postgresql.ENUM('YOUTUBE', 'TIKTOK', 'INSTAGRAM', name='publishplatform'),
               comment='公開プラットフォーム',
               existing_nullable=False)
    op.alter_column('publications', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SCHEDULED', 'PUBLISHING', 'PUBLISHED', 'FAILED', name='publishstatus'),
               comment='公開ステータス',
               existing_nullable=False)
    op.alter_column('publications', 'title',
               existing_type=sa.VARCHAR(length=500),
               comment='公開タイトル',
               existing_nullable=True)
    op.alter_column('publications', 'description',
               existing_type=sa.TEXT(),
               comment='公開説明文',
               existing_nullable=True)
    op.alter_column('publications', 'tags',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='タグ（JSON配列）',
               existing_nullable=True)
    op.alter_column('publications', 'platform_video_id',
               existing_type=sa.VARCHAR(length=200),
               type_=sa.String(length=100),
               comment='プラットフォーム側の動画ID',
               existing_nullable=True)
    op.alter_column('publications', 'platform_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='プラットフォーム側のURL',
               existing_nullable=True)
    op.alter_column('publications', 'scheduled_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='スケジュール公開日時',
               existing_nullable=True)
    op.alter_column('publications', 'published_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='公開完了日時',
               existing_nullable=True)
    op.alter_column('publications', 'publish_options',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='公開オプション（JSON）',
               existing_nullable=True)
    op.alter_column('publications', 'error_message',
               existing_type=sa.TEXT(),
               comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('publications', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('publications', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'id',
               existing_type=sa.UUID(),
               comment='スケジュールID（UUID）',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'platforms',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='対象プラットフォーム（JSON配列）',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'scheduled_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='スケジュール日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SCHEDULED', 'PUBLISHING', 'PUBLISHED', 'FAILED', name='publishstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'recurrence',
               existing_type=sa.VARCHAR(length=50),
               comment='繰り返し設定（daily/weekly/monthly）',
               existing_nullable=True)
    op.alter_column('publish_schedules', 'schedule_options',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='スケジュールオプション（JSON）',
               existing_nullable=True)
    op.alter_column('publish_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.drop_index(op.f('ix_publish_schedules_scheduled_at'), table_name='publish_schedules')
    op.create_index(op.f('ix_publish_schedules_status'), 'publish_schedules', ['status'], unique=False)
    op.add_column('scripts', sa.Column('knowledge_id', sa.UUID(), nullable=True, comment='ナレッジID（外部キー）'))
    op.add_column('scripts', sa.Column('title', sa.String(length=500), nullable=True, comment='台本タイトル'))
    op.add_column('scripts', sa.Column('prompt', sa.Text(), nullable=True, comment='生成に使用したプロンプト'))
    op.add_column('scripts', sa.Column('generator', sa.Enum('CLAUDE', 'GEMINI', name='generatortype'), nullable=False, comment='使用した生成エンジン'))
    op.add_column('scripts', sa.Column('estimated_duration', sa.Integer(), nullable=True, comment='予想再生時間（秒）'))
    op.alter_column('scripts', 'id',
               existing_type=sa.UUID(),
               comment='台本ID（UUID）',
               existing_nullable=False)
    op.alter_column('scripts', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('scripts', 'content',
               existing_type=sa.TEXT(),
               comment='台本本文',
               existing_nullable=True)
    op.alter_column('scripts', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'GENERATING', 'GENERATED', 'APPROVED', 'REJECTED', name='scriptstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('scripts', 'word_count',
               existing_type=sa.INTEGER(),
               comment='文字数',
               existing_nullable=True)
    op.alter_column('scripts', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('scripts', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('scripts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.create_index(op.f('ix_scripts_knowledge_id'), 'scripts', ['knowledge_id'], unique=False)
    op.create_foreign_key(None, 'scripts', 'knowledges', ['knowledge_id'], ['id'], ondelete='SET NULL')
    op.drop_column('scripts', 'error_message')
    op.drop_column('scripts', 'version')
    op.drop_column('scripts', 'generator_type')
    op.drop_column('scripts', 'estimated_duration_seconds')
    op.alter_column('system_settings', 'id',
               existing_type=sa.UUID(),
               comment='設定ID（UUID）',
               existing_nullable=False)
    op.alter_column('system_settings', 'key',
               existing_type=sa.VARCHAR(length=100),
               comment='設定キー',
               existing_nullable=False)
    op.alter_column('system_settings', 'value',
               existing_type=sa.TEXT(),
               comment='設定値',
               existing_nullable=True)
    op.alter_column('system_settings', 'value_type',
               existing_type=sa.VARCHAR(length=50),
               comment='値の型（string/number/boolean/json）',
               existing_nullable=False)
    op.alter_column('system_settings', 'description',
               existing_type=sa.TEXT(),
               comment='設定の説明',
               existing_nullable=True)
    op.alter_column('system_settings', 'is_public',
               existing_type=sa.BOOLEAN(),
               comment='公開設定かどうか',
               existing_nullable=False)
    op.alter_column('system_settings', 'updated_by',
               existing_type=sa.UUID(),
               comment='更新者ID',
               existing_nullable=True)
    op.alter_column('system_settings', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.alter_column('system_settings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='更新日時',
               existing_nullable=False)
    op.drop_constraint(op.f('system_settings_key_key'), 'system_settings', type_='unique')
    op.alter_column('thumbnails', 'id',
               existing_type=sa.UUID(),
               comment='サムネイルID（UUID）',
               existing_nullable=False)
    op.alter_column('thumbnails', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('thumbnails', 'prompt',
               existing_type=sa.TEXT(),
               comment='生成に使用したプロンプト',
               existing_nullable=True)
    op.alter_column('thumbnails', 'image_url',
               existing_type=sa.VARCHAR(length=1000),
               comment='生成された画像URL',
               existing_nullable=True)
    op.alter_column('thumbnails', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'GENERATING', 'GENERATED', 'APPROVED', 'REJECTED', name='thumbnailstatus'),
               comment='ステータス',
               existing_nullable=False)
    op.alter_column('thumbnails', 'width',
               existing_type=sa.INTEGER(),
               comment='画像幅（px）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'height',
               existing_type=sa.INTEGER(),
               comment='画像高さ（px）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.drop_column('thumbnails', 'updated_at')
    op.drop_column('thumbnails', 'error_message')
    op.drop_column('thumbnails', 'version')
    op.alter_column('video_analytics', 'id',
               existing_type=sa.UUID(),
               comment='分析ID（UUID）',
               existing_nullable=False)
    op.alter_column('video_analytics', 'video_id',
               existing_type=sa.UUID(),
               comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('video_analytics', 'date',
               existing_type=sa.DATE(),
               comment='分析日',
               existing_nullable=False)
    op.alter_column('video_analytics', 'views',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='視聴回数')
    op.alter_column('video_analytics', 'watch_time_minutes',
               existing_type=sa.INTEGER(),
               type_=sa.Float(),
               nullable=True,
               comment='総視聴時間（分）')
    op.alter_column('video_analytics', 'average_view_duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='平均視聴時間（秒）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'likes',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='いいね数')
    op.alter_column('video_analytics', 'dislikes',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='低評価数')
    op.alter_column('video_analytics', 'comments',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='コメント数')
    op.alter_column('video_analytics', 'shares',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='シェア数')
    op.alter_column('video_analytics', 'subscribers_gained',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='獲得登録者数')
    op.alter_column('video_analytics', 'subscribers_lost',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='解除登録者数')
    op.alter_column('video_analytics', 'ctr',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='クリック率（%）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'impressions',
               existing_type=sa.INTEGER(),
               nullable=True,
               comment='インプレッション数')
    op.alter_column('video_analytics', 'traffic_sources',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='トラフィックソース（JSON）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'demographics',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='視聴者属性（JSON）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment='作成日時',
               existing_nullable=False)
    op.drop_column('video_analytics', 'updated_at')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('video_analytics', sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.alter_column('video_analytics', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('video_analytics', 'demographics',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='視聴者属性（JSON）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'traffic_sources',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='トラフィックソース（JSON）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'impressions',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='インプレッション数')
    op.alter_column('video_analytics', 'ctr',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='クリック率（%）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'subscribers_lost',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='解除登録者数')
    op.alter_column('video_analytics', 'subscribers_gained',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='獲得登録者数')
    op.alter_column('video_analytics', 'shares',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='シェア数')
    op.alter_column('video_analytics', 'comments',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='コメント数')
    op.alter_column('video_analytics', 'dislikes',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='低評価数')
    op.alter_column('video_analytics', 'likes',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='いいね数')
    op.alter_column('video_analytics', 'average_view_duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='平均視聴時間（秒）',
               existing_nullable=True)
    op.alter_column('video_analytics', 'watch_time_minutes',
               existing_type=sa.Float(),
               type_=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='総視聴時間（分）')
    op.alter_column('video_analytics', 'views',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='視聴回数')
    op.alter_column('video_analytics', 'date',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='分析日',
               existing_nullable=False)
    op.alter_column('video_analytics', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('video_analytics', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='分析ID（UUID）',
               existing_nullable=False)
    op.add_column('thumbnails', sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('thumbnails', sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('thumbnails', sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.alter_column('thumbnails', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('thumbnails', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'height',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='画像高さ（px）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'width',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='画像幅（px）',
               existing_nullable=True)
    op.alter_column('thumbnails', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'GENERATING', 'GENERATED', 'APPROVED', 'REJECTED', name='thumbnailstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('thumbnails', 'image_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='生成された画像URL',
               existing_nullable=True)
    op.alter_column('thumbnails', 'prompt',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='生成に使用したプロンプト',
               existing_nullable=True)
    op.alter_column('thumbnails', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('thumbnails', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='サムネイルID（UUID）',
               existing_nullable=False)
    op.create_unique_constraint(op.f('system_settings_key_key'), 'system_settings', ['key'], postgresql_nulls_not_distinct=False)
    op.alter_column('system_settings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('system_settings', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('system_settings', 'updated_by',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='更新者ID',
               existing_nullable=True)
    op.alter_column('system_settings', 'is_public',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='公開設定かどうか',
               existing_nullable=False)
    op.alter_column('system_settings', 'description',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='設定の説明',
               existing_nullable=True)
    op.alter_column('system_settings', 'value_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='値の型（string/number/boolean/json）',
               existing_nullable=False)
    op.alter_column('system_settings', 'value',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='設定値',
               existing_nullable=True)
    op.alter_column('system_settings', 'key',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='設定キー',
               existing_nullable=False)
    op.alter_column('system_settings', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='設定ID（UUID）',
               existing_nullable=False)
    op.add_column('scripts', sa.Column('estimated_duration_seconds', sa.INTEGER(), autoincrement=False, nullable=True))
    op.add_column('scripts', sa.Column('generator_type', postgresql.ENUM('CLAUDE', 'GEMINI', 'MANUAL', name='generatortype'), autoincrement=False, nullable=False))
    op.add_column('scripts', sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('scripts', sa.Column('error_message', sa.TEXT(), autoincrement=False, nullable=True))
    op.drop_constraint(None, 'scripts', type_='foreignkey')
    op.drop_index(op.f('ix_scripts_knowledge_id'), table_name='scripts')
    op.alter_column('scripts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('scripts', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('scripts', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('scripts', 'word_count',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='文字数',
               existing_nullable=True)
    op.alter_column('scripts', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'GENERATING', 'GENERATED', 'APPROVED', 'REJECTED', name='scriptstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('scripts', 'content',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='台本本文',
               existing_nullable=True)
    op.alter_column('scripts', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('scripts', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='台本ID（UUID）',
               existing_nullable=False)
    op.drop_column('scripts', 'estimated_duration')
    op.drop_column('scripts', 'generator')
    op.drop_column('scripts', 'prompt')
    op.drop_column('scripts', 'title')
    op.drop_column('scripts', 'knowledge_id')
    op.drop_index(op.f('ix_publish_schedules_status'), table_name='publish_schedules')
    op.create_index(op.f('ix_publish_schedules_scheduled_at'), 'publish_schedules', ['scheduled_at'], unique=False)
    op.alter_column('publish_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'schedule_options',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='スケジュールオプション（JSON）',
               existing_nullable=True)
    op.alter_column('publish_schedules', 'recurrence',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='繰り返し設定（daily/weekly/monthly）',
               existing_nullable=True)
    op.alter_column('publish_schedules', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SCHEDULED', 'PUBLISHING', 'PUBLISHED', 'FAILED', name='publishstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'scheduled_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='スケジュール日時',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'platforms',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='対象プラットフォーム（JSON配列）',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('publish_schedules', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='スケジュールID（UUID）',
               existing_nullable=False)
    op.alter_column('publications', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('publications', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('publications', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('publications', 'publish_options',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='公開オプション（JSON）',
               existing_nullable=True)
    op.alter_column('publications', 'published_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='公開完了日時',
               existing_nullable=True)
    op.alter_column('publications', 'scheduled_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='スケジュール公開日時',
               existing_nullable=True)
    op.alter_column('publications', 'platform_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='プラットフォーム側のURL',
               existing_nullable=True)
    op.alter_column('publications', 'platform_video_id',
               existing_type=sa.String(length=100),
               type_=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='プラットフォーム側の動画ID',
               existing_nullable=True)
    op.alter_column('publications', 'tags',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='タグ（JSON配列）',
               existing_nullable=True)
    op.alter_column('publications', 'description',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='公開説明文',
               existing_nullable=True)
    op.alter_column('publications', 'title',
               existing_type=sa.VARCHAR(length=500),
               comment=None,
               existing_comment='公開タイトル',
               existing_nullable=True)
    op.alter_column('publications', 'status',
               existing_type=postgresql.ENUM('DRAFT', 'SCHEDULED', 'PUBLISHING', 'PUBLISHED', 'FAILED', name='publishstatus'),
               comment=None,
               existing_comment='公開ステータス',
               existing_nullable=False)
    op.alter_column('publications', 'platform',
               existing_type=postgresql.ENUM('YOUTUBE', 'TIKTOK', 'INSTAGRAM', name='publishplatform'),
               comment=None,
               existing_comment='公開プラットフォーム',
               existing_nullable=False)
    op.alter_column('publications', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('publications', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='公開ID（UUID）',
               existing_nullable=False)
    op.add_column('project_schedules', sa.Column('publish_time', postgresql.TIME(), autoincrement=False, nullable=True))
    op.add_column('project_schedules', sa.Column('priority', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('project_schedules', sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True))
    op.drop_index(op.f('ix_project_schedules_project_id'), table_name='project_schedules')
    op.create_index(op.f('ix_project_schedules_project_id'), 'project_schedules', ['project_id'], unique=False)
    op.alter_column('project_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('project_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('project_schedules', 'scheduled_date',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='予定日',
               existing_nullable=False)
    op.alter_column('project_schedules', 'project_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='プロジェクトID（外部キー）',
               existing_nullable=False)
    op.alter_column('project_schedules', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='スケジュールID（UUID）',
               existing_nullable=False)
    op.drop_column('project_schedules', 'published_date')
    op.add_column('planning_chat_sessions', sa.Column('project_id', sa.UUID(), autoincrement=False, nullable=False))
    op.add_column('planning_chat_sessions', sa.Column('context', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('planning_chat_sessions', sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False))
    op.drop_constraint(None, 'planning_chat_sessions', type_='foreignkey')
    op.drop_constraint(None, 'planning_chat_sessions', type_='foreignkey')
    op.create_foreign_key(op.f('planning_chat_sessions_project_id_fkey'), 'planning_chat_sessions', 'projects', ['project_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('planning_chat_sessions_user_id_fkey'), 'planning_chat_sessions', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_planning_chat_sessions_knowledge_id'), table_name='planning_chat_sessions')
    op.drop_index(op.f('ix_planning_chat_sessions_client_id'), table_name='planning_chat_sessions')
    op.create_index(op.f('ix_planning_chat_sessions_user_id'), 'planning_chat_sessions', ['user_id'], unique=False)
    op.create_index(op.f('ix_planning_chat_sessions_project_id'), 'planning_chat_sessions', ['project_id'], unique=False)
    op.alter_column('planning_chat_sessions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'messages',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               nullable=True,
               comment=None,
               existing_comment="メッセージ履歴（[{type: 'user'|'assistant', content: str, suggestions: [], created_at: str}]）")
    op.alter_column('planning_chat_sessions', 'status',
               existing_type=postgresql.ENUM('ACTIVE', 'COMPLETED', 'ABANDONED', name='planningsessionstatus'),
               comment=None,
               existing_comment='セッションステータス',
               existing_nullable=False)
    op.alter_column('planning_chat_sessions', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='セッションID（UUID）',
               existing_nullable=False)
    op.drop_column('planning_chat_sessions', 'knowledge_id')
    op.drop_column('planning_chat_sessions', 'client_id')
    op.add_column('metadata_generations', sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.add_column('metadata_generations', sa.Column('category', sa.VARCHAR(length=100), autoincrement=False, nullable=True))
    op.add_column('metadata_generations', sa.Column('tags', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('metadata_generations', sa.Column('title', sa.VARCHAR(length=500), autoincrement=False, nullable=True))
    op.add_column('metadata_generations', sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('metadata_generations', sa.Column('version', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('metadata_generations', sa.Column('generation_params', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.drop_index(op.f('ix_metadata_generations_metadata_type'), table_name='metadata_generations')
    op.alter_column('metadata_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('metadata_generations', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('metadata_generations', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='生成履歴ID（UUID）',
               existing_nullable=False)
    op.drop_column('metadata_generations', 'alternatives')
    op.drop_column('metadata_generations', 'result')
    op.drop_column('metadata_generations', 'prompt')
    op.drop_column('metadata_generations', 'metadata_type')
    op.add_column('channel_analytics', sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.alter_column('channel_analytics', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'top_videos',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='トップ動画（JSON）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'revenue',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='収益（円）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'average_ctr',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='平均クリック率（%）',
               existing_nullable=True)
    op.alter_column('channel_analytics', 'total_videos',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='総動画数')
    op.alter_column('channel_analytics', 'subscribers_change',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='登録者数変化')
    op.alter_column('channel_analytics', 'subscribers',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='総登録者数')
    op.alter_column('channel_analytics', 'total_watch_time_minutes',
               existing_type=sa.Float(),
               type_=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='総視聴時間（分）')
    op.alter_column('channel_analytics', 'total_views',
               existing_type=sa.INTEGER(),
               nullable=False,
               comment=None,
               existing_comment='総視聴回数')
    op.alter_column('channel_analytics', 'date',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='分析日',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'client_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='クライアントID（外部キー）',
               existing_nullable=False)
    op.alter_column('channel_analytics', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='分析ID（UUID）',
               existing_nullable=False)
    op.alter_column('broll_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('broll_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('broll_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('broll_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'timestamp_end',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='挿入終了位置（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'timestamp_start',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='挿入開始位置（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'veo_task_id',
               existing_type=sa.String(length=100),
               type_=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='Veo タスクID',
               existing_nullable=True)
    op.alter_column('broll_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('broll_generations', 'height',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='動画高さ（px）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'width',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='動画幅（px）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='動画長（秒）',
               existing_nullable=True)
    op.alter_column('broll_generations', 'thumbnail_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='動画サムネイルURL',
               existing_nullable=True)
    op.alter_column('broll_generations', 'video_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='生成された動画URL',
               existing_nullable=True)
    op.alter_column('broll_generations', 'style',
               existing_type=sa.String(length=50),
               type_=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='映像スタイル',
               existing_nullable=True)
    op.alter_column('broll_generations', 'prompt',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='生成プロンプト',
               existing_nullable=True)
    op.alter_column('broll_generations', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('broll_generations', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='B-roll生成ID（UUID）',
               existing_nullable=False)
    op.drop_index(op.f('ix_avatar_generations_audio_id'), table_name='avatar_generations')
    op.alter_column('avatar_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'heygen_task_id',
               existing_type=sa.String(length=100),
               type_=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='HeyGen タスクID',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'height',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='動画高さ（px）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'width',
               existing_type=sa.INTEGER(),
               comment=None,
               existing_comment='動画幅（px）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='動画長（秒）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'thumbnail_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='動画サムネイルURL',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'video_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='生成された動画URL',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'avatar_name',
               existing_type=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='アバター名',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'avatar_id',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='HeyGen アバターID',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'audio_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='音声ID（外部キー）',
               existing_nullable=True)
    op.alter_column('avatar_generations', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('avatar_generations', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='アバター生成ID（UUID）',
               existing_nullable=False)
    op.alter_column('audit_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('audit_logs', 'extra_data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='追加メタデータ',
               existing_nullable=True)
    op.alter_column('audit_logs', 'user_agent',
               existing_type=sa.VARCHAR(length=500),
               comment=None,
               existing_comment='ユーザーエージェント',
               existing_nullable=True)
    op.alter_column('audit_logs', 'ip_address',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='IPアドレス',
               existing_nullable=True)
    op.alter_column('audit_logs', 'description',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='説明',
               existing_nullable=True)
    op.alter_column('audit_logs', 'resource_id',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='リソースID',
               existing_nullable=True)
    op.alter_column('audit_logs', 'resource_type',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='リソース種別',
               existing_nullable=False)
    op.alter_column('audit_logs', 'action',
               existing_type=postgresql.ENUM('CREATE', 'READ', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT', 'EXPORT', 'GENERATE', name='auditaction'),
               comment=None,
               existing_comment='アクション',
               existing_nullable=False)
    op.alter_column('audit_logs', 'user_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='ユーザーID',
               existing_nullable=True)
    op.alter_column('audit_logs', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='ログID（UUID）',
               existing_nullable=False)
    op.drop_index(op.f('ix_audio_generations_script_id'), table_name='audio_generations')
    op.alter_column('audio_generations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('audio_generations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('audio_generations', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('audio_generations', 'generation_params',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='生成パラメータ（JSON）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'pitch',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='ピッチ調整',
               existing_nullable=True)
    op.alter_column('audio_generations', 'speed',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='読み上げ速度',
               existing_nullable=True)
    op.alter_column('audio_generations', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='generationstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('audio_generations', 'duration',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='音声長（秒）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'audio_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='生成された音声URL',
               existing_nullable=True)
    op.alter_column('audio_generations', 'text',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='読み上げテキスト',
               existing_nullable=True)
    op.alter_column('audio_generations', 'voice_name',
               existing_type=sa.VARCHAR(length=200),
               comment=None,
               existing_comment='ボイス名',
               existing_nullable=True)
    op.alter_column('audio_generations', 'voice_id',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='MiniMax Audio ボイスID',
               existing_nullable=True)
    op.alter_column('audio_generations', 'script_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='台本ID（外部キー）',
               existing_nullable=True)
    op.alter_column('audio_generations', 'video_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='動画ID（外部キー）',
               existing_nullable=False)
    op.alter_column('audio_generations', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='音声生成ID（UUID）',
               existing_nullable=False)
    op.alter_column('api_connections', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('api_connections', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('api_connections', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('api_connections', 'last_sync_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='最終同期日時',
               existing_nullable=True)
    op.alter_column('api_connections', 'settings',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='連携設定',
               existing_nullable=True)
    op.alter_column('api_connections', 'credentials',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='認証情報（暗号化済み）',
               existing_nullable=True)
    op.alter_column('api_connections', 'status',
               existing_type=postgresql.ENUM('ACTIVE', 'INACTIVE', 'ERROR', name='apiconnectionstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('api_connections', 'client_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='クライアントID（クライアント固有の場合）',
               existing_nullable=True)
    op.alter_column('api_connections', 'service',
               existing_type=sa.VARCHAR(length=50),
               comment=None,
               existing_comment='サービス名（youtube/tiktok/heygen等）',
               existing_nullable=False)
    op.alter_column('api_connections', 'name',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment='連携名',
               existing_nullable=False)
    op.alter_column('api_connections', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='連携ID（UUID）',
               existing_nullable=False)
    op.drop_index(op.f('ix_analytics_reports_status'), table_name='analytics_reports')
    op.alter_column('analytics_reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='更新日時',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'error_message',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='エラーメッセージ',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'file_url',
               existing_type=sa.VARCHAR(length=1000),
               comment=None,
               existing_comment='レポートファイルURL',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'data',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='レポートデータ（JSON）',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'summary',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='レポートサマリー',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'date_to',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='終了日',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'date_from',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='開始日',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'title',
               existing_type=sa.VARCHAR(length=500),
               comment=None,
               existing_comment='レポートタイトル',
               existing_nullable=True)
    op.alter_column('analytics_reports', 'status',
               existing_type=postgresql.ENUM('PENDING', 'GENERATING', 'COMPLETED', 'FAILED', name='reportstatus'),
               comment=None,
               existing_comment='ステータス',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'report_type',
               existing_type=postgresql.ENUM('DAILY', 'WEEKLY', 'MONTHLY', 'CUSTOM', name='reporttype'),
               comment=None,
               existing_comment='レポートタイプ',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'client_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='クライアントID（外部キー）',
               existing_nullable=False)
    op.alter_column('analytics_reports', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='レポートID（UUID）',
               existing_nullable=False)
    op.add_column('ai_suggestions', sa.Column('feedback', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('ai_suggestions', sa.Column('confidence_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True))
    op.add_column('ai_suggestions', sa.Column('content', sa.TEXT(), autoincrement=False, nullable=False))
    op.add_column('ai_suggestions', sa.Column('metadata', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.drop_constraint(None, 'ai_suggestions', type_='foreignkey')
    op.drop_index(op.f('ix_ai_suggestions_adopted_project_id'), table_name='ai_suggestions')
    op.create_index(op.f('ix_ai_suggestions_suggestion_type'), 'ai_suggestions', ['suggestion_type'], unique=False)
    op.alter_column('ai_suggestions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='作成日時',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'adopted_at',
               existing_type=postgresql.TIMESTAMP(),
               comment=None,
               existing_comment='採用日時',
               existing_nullable=True)
    op.alter_column('ai_suggestions', 'is_adopted',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='採用フラグ',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'suggestion_type',
               existing_type=postgresql.ENUM('TITLE', 'TOPIC', 'OUTLINE', 'HOOK', 'CTA', 'TARGET_AUDIENCE', name='suggestiontype'),
               comment=None,
               existing_comment='提案種別（short/long）',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'session_id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='セッションID（外部キー）',
               existing_nullable=False)
    op.alter_column('ai_suggestions', 'id',
               existing_type=sa.UUID(),
               comment=None,
               existing_comment='提案ID（UUID）',
               existing_nullable=False)
    op.drop_column('ai_suggestions', 'adopted_project_id')
    op.drop_column('ai_suggestions', 'confidence')
    op.drop_column('ai_suggestions', 'estimated_views')
    op.drop_column('ai_suggestions', 'tags')
    op.drop_column('ai_suggestions', 'description')
    op.drop_column('ai_suggestions', 'title')
    op.drop_table('agent_logs')
    op.drop_table('retention_events')
    op.drop_index(op.f('ix_engagement_metrics_recorded_date'), table_name='engagement_metrics')
    op.drop_index(op.f('ix_engagement_metrics_link_id'), table_name='engagement_metrics')
    op.drop_table('engagement_metrics')
    op.drop_table('end_screen_elements')
    op.drop_table('dna_elements')
    op.drop_table('dna_comparisons')
    op.drop_table('agent_tasks')
    op.drop_table('ab_test_variants')
    op.drop_index(op.f('ix_video_cta_assignments_video_id'), table_name='video_cta_assignments')
    op.drop_index(op.f('ix_video_cta_assignments_placement'), table_name='video_cta_assignments')
    op.drop_index(op.f('ix_video_cta_assignments_cta_id'), table_name='video_cta_assignments')
    op.drop_table('video_cta_assignments')
    op.drop_table('trend_alerts')
    op.drop_table('tasks')
    op.drop_index(op.f('ix_short_video_clips_source_video_id'), table_name='short_video_clips')
    op.drop_index(op.f('ix_short_video_clips_short_video_id'), table_name='short_video_clips')
    op.drop_table('short_video_clips')
    op.drop_index(op.f('ix_short_to_long_links_status'), table_name='short_to_long_links')
    op.drop_index(op.f('ix_short_to_long_links_short_video_id'), table_name='short_to_long_links')
    op.drop_index(op.f('ix_short_to_long_links_long_video_id'), table_name='short_to_long_links')
    op.drop_table('short_to_long_links')
    op.drop_index(op.f('ix_series_video_items_video_id'), table_name='series_video_items')
    op.drop_index(op.f('ix_series_video_items_series_id'), table_name='series_video_items')
    op.drop_table('series_video_items')
    op.drop_index(op.f('ix_series_performance_logs_series_id'), table_name='series_performance_logs')
    op.drop_index(op.f('ix_series_performance_logs_recorded_date'), table_name='series_performance_logs')
    op.drop_table('series_performance_logs')
    op.drop_table('retention_curves')
    op.drop_table('recommendations')
    op.drop_table('posting_schedule_recommendations')
    op.drop_table('performance_records')
    op.drop_table('end_screens')
    op.drop_index(op.f('ix_cta_click_logs_video_id'), table_name='cta_click_logs')
    op.drop_index(op.f('ix_cta_click_logs_cta_id'), table_name='cta_click_logs')
    op.drop_index(op.f('ix_cta_click_logs_clicked_at'), table_name='cta_click_logs')
    op.drop_table('cta_click_logs')
    op.drop_table('content_dnas')
    op.drop_table('competitor_alerts')
    op.drop_table('comment_queue')
    op.drop_table('agent_schedules')
    op.drop_table('ab_tests')
    op.drop_index(op.f('ix_series_youtube_playlist_id'), table_name='series')
    op.drop_index(op.f('ix_series_status'), table_name='series')
    op.drop_index(op.f('ix_series_series_type'), table_name='series')
    op.drop_index(op.f('ix_series_project_id'), table_name='series')
    op.drop_index(op.f('ix_series_knowledge_id'), table_name='series')
    op.drop_table('series')
    op.drop_table('learning_insights')
    op.drop_table('comment_templates')
    op.drop_table('agents')
    op.drop_table('notifications')
    op.drop_table('end_screen_templates')
    op.drop_table('dna_templates')
    op.drop_index(op.f('ix_cta_templates_type'), table_name='cta_templates')
    op.drop_index(op.f('ix_cta_templates_placement'), table_name='cta_templates')
    op.drop_index(op.f('ix_cta_templates_name'), table_name='cta_templates')
    op.drop_index(op.f('ix_cta_templates_is_active'), table_name='cta_templates')
    op.drop_table('cta_templates')
    op.drop_table('utm_default_settings')
    op.drop_table('success_patterns')
    op.drop_table('posting_time_analyses')
    op.drop_table('learning_history')
    op.drop_table('channel_dna_profiles')
    # ### end Alembic commands ###
